---
title: "Pre Interview Analysis Test"
author: "Nils Indreiten"
date: "01/09/2021"
output:
  word_document: default
   toc: 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(tidyverse,ggpubr)
```
# Business Problem:

A game in development has just been tested on 1000 users but only a few are getting to checkpoint 30. You have been provided with a summary of user data 
broken down by game checkpoint. Users can only progress to the next checkpoint when the previous has been passed. Users can re-play any passed checkpoint. 
The game design team asked you to help by giving an overview of what's going on. The data has counts of unique users and events (start/pass/fail/quit) 
triggered and some information related to sessions per checkpoint.

# User Progression

```{r, echo=FALSE,fig.align='center'}
players <- read.csv("Player_Prog.csv")
knitr::kable(head(players))
```

Lets quickly look at the user count at each checkpoint:
```{r, echo=FALSE,fig.align='center',message=FALSE}
library(ggalt)
players %>% 
ggplot(aes(fct_reorder(Checkpoint,usercount),usercount))+
  geom_lollipop(point.colour="orange")+
coord_flip()+
  theme_light()+
  xlab("Checkpoint")+
  ylab("User Count")+
  ggtitle("User count at each checkpoint")
ggsave("users_checkpoint.jpeg")
```

Q1. Overview of user progression, lets focus on the overall 
starts, fails and quits first:

Lets visualize some player progression metrics,the total starts, total fails, and the total passes per checkpoint:

```{r,echo=FALSE,fig.align='center'}

p1 <- players %>% 
  ggplot(aes(Checkpoint,total_start))+
  geom_line(group=1,color="orange")+
  theme_light ()+
    theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+
    xlab("")+ylab("Total Starts")+
  ggtitle("Progression Metrics")
  

p3 <- players %>% 
  ggplot(aes(Checkpoint,total_fail))+
  geom_line(group=1,colour="red")+
  theme_light()+
  theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+xlab("")+ylab("Total Fails")

p4 <- players %>% 
  ggplot(aes(Checkpoint,total_quit))+
  geom_line(group=1,colour="purple")+
  theme_light()+
  theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+xlab("Checkpoint")+ylab("Total Quits")
  

ggarrange(p1,p3,p4,nrow = 3)
ggsave(filename="prog_metrics.jpeg")
```

The graphs above demonstrate the users are having to start a level a significant amount of times relative to other checkpoints,
checkpoint 15 and 17, seem to be giving players a hard time. A higher number starts at these checkpoints may be indicative of the 
player experience, there may be a bug, a mini-boss, or perhaps a challenging platforming section at this checkpoint. Similarly,
ad perhaps unsurprisingly the total number of fails at checkpoint 15 and 17 seems to follow a similar pattern to the total starts,
indicating that a relatively larger number of users are failing at these checkpoints. In addition and perhaps unsurprisingly the
total quits seems to follow a similar pattern, suggesting that users are quiting at higher rates at these checkpoints, are these
checkpoints too difficult for players? Are they rage quitting? It would be wise to take a closer look at these levels.

As for the total passes, it seems that  as the players progress through the game, a lower proportion pass to the next checkpoint. This 
is perhaps not that surprising, as difficulty may vary as players play through the game. The toal passes is shown below:

```{r,echo=FALSE,fig.align='center'}
 players %>% 
  ggplot(aes(Checkpoint,total_pass))+
  geom_line(group=1)+
  theme_light()+
    theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+
      xlab("Checkpoint")+
  ylab("Total Passes")+
  ggtitle("Total passes at each checkpoint")
  ggsave(filename="Total_passes.jpeg")

```


Lets see if there is a similar pattern but at the unique user level:
```{r, echo=FALSE,fig.align='center'}
p1 <- players %>% 
  ggplot(aes(Checkpoint,unique_user_fail))+
  geom_line(group=1,colour="red")+
  theme_light()+
    theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+
      xlab("Checkpoint")+
  ylab("Unique Failures")+
  ggtitle("Unique user progression metrics")
  

p2 <- players %>% 
  ggplot(aes(Checkpoint,unique_user_quit))+
  geom_line(group=1,colour="Purple")+
  theme_light()+
    theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+
      xlab("Checkpoint")+
  ylab("Unique Quits")

ggarrange(p1,p2,nrow=2)
ggsave(filename="metrics_ind_level.jpeg")
```

```{r,echo=FALSE,,fig.align='center'}
players %>% 
  ggplot(aes(Checkpoint,unique_user_pass))+
  geom_line(group=1)+
  theme_light()+
    theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+
      xlab("Checkpoint")+
  ylab("Unique passes")+
  ggtitle("Unique passes at each checkpoint")
ggsave(filename = "unique_passes.jpeg")
  
```

At the unique user level we see a similar pattern s in the total metrics, however the distinction is not as stark, this may be due to 
the fact that players are allowed to replay any passed checkpoint, and thus may have more chances to fail. Two main trends at the unique user level stand out. The first is at checkpoints 3, 5, and 7, where we see a relatively high number of failures and quits,
particularly at checkpoint three, which has the highest unique failures and quits. The second is at checkpoints 15 and 17, this 
corroborates the previous analysis and suggests that these checkpoints are potentially problematic. Finally the unique 
passes follows a corresponding pattern to the total passes, however it is a cause for concern that the number of passes
dramatically decreases between checkpoint 1 and checkpoint 7, in fact, less than half of the players remain by checkpoint 
7 which is only 46% of the game.


## Checkpoints to focus on:

Given the patterns identified above it is recommended that the development team focus on checkpoints 3, 15 and 17. The same 
patterns are evident in the total user metrics as well as for the unique user metrics. In short, checkpoints 15 and 17 have the highest total starts, fails and quits, relative to other checkpoints. Suggesting that these may be bottleneck points inhibiting user
progression. Similarly this is evident at the unique user level, however, checkpoint 3 is also identified as a source of failure and
players quits. Finally the steep decrease in proportion of users passing at checkpoint 3 is alarming and in fact, seems to continue until checkpoint three, where the rate of passing seems to decrease at a more steady rate. the table below summarises 
the key findings:

```{r,echo=FALSE,,fig.align='center'}
x <- tribble(~"Checkpoint",~"Justification",
             "3","Steep increase in number of users not progressing. A relatively high number of user failures and quits.",
             "15 &17","A relatively high number of user failures and quits, as well as a high number of total starts",
              )
x
```

It may be useful to consider the suggestions to focus on these checkpoints by consulting the number or unique users at the first,
halfway, and final checkpoints. This is shown in the figure below:

```{r,echo=FALSE,fig.align='center'}
players %>% 
  filter(Checkpoint %in% c("CP #01","CP #15","CP #30")) %>% 
  select(Checkpoint,usercount) %>% 
  ggplot(aes(Checkpoint,usercount))+
  geom_col(fill="midnightblue")+
  theme_light()+
  ylab("User Count")+
  ggtitle("Users at first, mid, and final checkpoints")
ggsave(filename = "count_at_mid_check.jpeg")
```

# How are players behaving?:



```{r,echo=FALSE,,fig.align='center'}
players %>% 
  ggplot(aes(Checkpoint, avg_checkpoint_duration..sec.)) +
  geom_line(group=1)+
  geom_point()+theme_minimal()+theme(axis.text.x = element_text(angle=45,vjust=1,hjust=1))+xlab("")+ylab("Average Duration (seconds)")+
  ggtitle("What is the average duration at each checkpoint?")+xlab("Checkpoint")
ggsave(filename = "average_dur.jpeg")
```
It seems that players are spending a substantially higher amount of time at each checkpoint from #CP 26 onwards, is there
a mini boss or boss towards the later half of the game? If we use average duration as a proxy for difficulty then it certainly seems
that difficulty increases at the later stages. 

# Correlation matrix between the unique user metrics

We may want to see the extent to which the variables are correlated with each other, this will give us an indication
of what variables are explained by others. For example is average duration correlated with total quits?
Well start by taking a look at the total user metrics:
```{r,echo=FALSE,,fig.align='center'}
cor2 <- players %>% 
  select(-starts_with("unique"),-Checkpoint,-usercount,-avg_checkpoint_duration..sec.)
cor.mat <- round(cor(cor2),3)
lengthened <- pivot_longer(as_tibble(cor.mat,rownames="row"),-row)
ggplot(lengthened, aes(row, name,fill=value))+
  geom_tile(color="white")+
  scale_fill_gradient2(low="#CB181D",high="#2171B5",mid = "white", midpoint = 0,limit=c(-1,1),space="Lab",name="Correlation")+
  theme_minimal()+
  coord_fixed()+
  geom_text(aes(row,name,label=value),
            color="black",size=2)+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45,vjust=1,hjust=1))+
  xlab("")+
  ylab("")+
  ggtitle("Correlation between total metrics")
ggsave("total_corr.jpeg")
```

A few things to note here, it seems that total passes and average cumulative play time are strongly negatively correlated.
That is, as the average cumulative playtime increases, the total passes decreases. Similarly, in line with previous findings it
seems that total fails and total quits are strongly positively correlated, indicating that the more users fail the more likely
they are to quit. 

Next lets turn our attention to the unique user variables:

```{r,echo=FALSE,,fig.align='center'}
cor <- players %>% 
  select(starts_with("unique"),-Checkpoint,-usercount,-avg_cumulative_playtime..sec.,-failing_prop)
cor.mat <- round(cor(cor),3)
lengthened <- pivot_longer(as_tibble(cor.mat,rownames="row"),-row)
ggplot(lengthened, aes(row, name,fill=value))+
  geom_tile(color="white")+
  scale_fill_gradient2(low="#CB181D",high="#2171B5",mid = "white", midpoint = 0,limit=c(-1,1),space="Lab",name="Correlation")+
  theme_minimal()+
  coord_fixed()+
  geom_text(aes(row,name,label=value),
            color="black",size=2)+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45,vjust=1,hjust=1))+
  xlab("")+
  ylab("")+
  ggtitle("Correlation between total metrics")
ggsave("total_metrics.jpeg")

```
Interestingly we see similar results at the unique user level, that unique user fails and unique user quits are strongly 
positively correlated. In addition, the relationship between average duration and unique user passes is also present here, 
albeit to a lesser extent, nevertheless, this suggests that as the average duration at each checkpoint increases the lower
the number of unique passes. 

Are these relationships statistically significant? Lets run some models:

# Modelling variable relationships:


Lets try to further understand the relationship between the unique variable metrics, focusing on unique user quits and with a=0.05 confidence 
interval measure. The model results demonstrate that, unique user fails and user count have a statistically significant positive relationship with unique user quits. In other words as more unique players fails and as more unique users there are at each checkpoint
the higher the unique user quits. On the other hand, unique user passes has a statistically significant negative effect on unique
user quits. So, as more players pass,the lower the level of unique player quits. The effect of average checkpoint duration is not
statistically significant. These results are demonstrated below:

```{r,echo=FALSE,message=FALSE,warning=FALSE,,fig.align='center'}
library(tidymodels)
unique_quit_lm <- lm(unique_user_quit~ unique_user_fail+usercount+unique_user_pass+avg_checkpoint_duration..sec.,data=players)
knitr::kable(tidy(unique_quit_lm))
```

Visuaising the model:

```{r,echo=FALSE,message=FALSE,warning=FALSE,,fig.align='center'}
library(visreg)
visreg(unique_quit_lm,"unique_user_fail",gg=TRUE)+theme_light()+ylab("Unique user quits")+xlab("Unique user fails")
ggsave("vis_reg1.jpeg")
```

In a similar vain we may wish to repeat the model but this time focusing on unique user passes. As in the previous model average
checkpoint duration has no statistically significant effect on unique user passes. However, in this case the effect of unique
user fails is not statistically significant. Unique user quits is significant, suggesting that as more unique users quit
the less likely they are to pass. Finally, and perhaps unsurprisingly as the number of users increases so too does the number of unique
passes. 

```{r,echo=FALSE,message=FALSE,warning=FALSE,fig.align='center'}
unique_pass_lm <- lm(unique_user_pass~ unique_user_fail+usercount+unique_user_quit+avg_checkpoint_duration..sec.,data=players)
knitr::kable(tidy(unique_pass_lm))
```

We can visualise this relationship:

```{r, echo=FALSE,message=FALSE,warning=FALSE,fig.align='center'}
visreg(unique_pass_lm,"unique_user_quit",gg=TRUE)+theme_light()+xlab("Unique user quits")+ylab("Unique user passes")
ggsave("reg_vis.jpeg")
```

# Conclusion

From these analysis we can conclude that when addressing unique user quit rates, efforts can be focused at improving passing and failure rates by perhaps tuning level difficulty. On the other hand this will also stimulate user passing rates, and increase 
the number of unique players at latter checkpoints in the game.The suggestion to fcuse on checkpoints 3, 15, and 17 may provide 
some solutions to the issues discussed throughout this report. 

# Future directions:

Future analysis may wish to engage with individual level data, that is, with user data that has a single entry for each
user individual user. This will allow for predictive modelling, attempting to predict certain outcomes, for instance predicting whether a user will quit a checkpoint, based on a set of attributes, these may include but may not be limited to the ones in this datset. 


